{"version":3,"file":"StatusChip-oqenBLHJ.js","sources":["../../src/components/StatusDiagnosticsModal.tsx","../../src/components/StatusChip.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\r\nimport { useHealth } from '../hooks/useHealth';\r\n\r\nfunction relativeTime(iso?: string) {\r\n  if (!iso) return 'unknown';\r\n  const d = Date.parse(iso);\r\n  const s = Math.floor((Date.now() - d) / 1000);\r\n  if (s < 60) return `${s}s ago`;\r\n  if (s < 3600) return `${Math.floor(s/60)}m ago`;\r\n  return `${Math.floor(s/3600)}h ago`;\r\n}\r\n\r\nconst DiagnosticsModal: React.FC<{ onClose: () => void; baseUrl: string }> = ({ onClose, baseUrl }) => {\r\n  const { checks, lastSuccess, retry, version } = useHealth();\r\n  const dialogRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => { if (e.key === 'Escape') onClose(); };\r\n    document.addEventListener('keydown', onKey);\r\n    return () => document.removeEventListener('keydown', onKey);\r\n  }, [onClose]);\r\n\r\n  const copyDiagnostics = async () => {\r\n    const payload = { checks, lastSuccess, version, baseUrl };\r\n    try { await navigator.clipboard.writeText(JSON.stringify(payload)); } catch (e) { /* ignore */ }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"absolute inset-0 bg-black/50\" onClick={onClose} />\r\n      <div className=\"relative bg-secondary border border-border rounded-lg p-4 w-full max-w-2xl z-10\" role=\"dialog\" aria-modal>\r\n        <div className=\"flex justify-between items-start\">\r\n          <h3 className=\"text-lg font-semibold\">Backend Diagnostics</h3>\r\n          <div className=\"space-x-2\">\r\n            <button onClick={copyDiagnostics} className=\"px-2 py-1 bg-primary text-primary-foreground rounded\">Copy diagnostics</button>\r\n            <button onClick={() => { retry(); }} className=\"px-2 py-1 bg-secondary-foreground border rounded\">Retry now</button>\r\n            <button onClick={onClose} className=\"px-2 py-1\">Close</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <h4 className=\"text-sm font-medium\">Recent Checks</h4>\r\n            <div className=\"mt-2 overflow-auto max-h-64\">\r\n              <table className=\"w-full text-sm\">\r\n                <thead>\r\n                  <tr className=\"text-left text-muted-foreground\"><th>Time</th><th>Status</th><th>Latency</th><th>Error</th></tr>\r\n                </thead>\r\n                <tbody>\r\n                  {checks.map((c, i) => (\r\n                    <tr key={i} className=\"border-t border-border/50\">\r\n                      <td className=\"py-1\">{relativeTime(c.ts)}</td>\r\n                      <td className=\"py-1\">{c.ok ? 'ok' : 'fail'}</td>\r\n                      <td className=\"py-1\">{c.latencyMs ? `${c.latencyMs}ms` : '-'}</td>\r\n                      <td className=\"py-1 truncate\">{c.error || c.snippet || '-'}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <h4 className=\"text-sm font-medium\">Configuration</h4>\r\n            <div className=\"mt-2 text-sm font-mono bg-background border border-border p-2 rounded\">\r\n              <div><strong>BASE_URL:</strong> {baseUrl}</div>\r\n              <div><strong>Health path:</strong> /api/health</div>\r\n              <div><strong>CORS origin:</strong> {location.origin}</div>\r\n              <div><strong>Version:</strong> {version || 'unknown'}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DiagnosticsModal;\r\n","import React, { useState } from 'react';\r\nimport { useHealth } from '../hooks/useHealth';\r\nimport DiagnosticsModal from './StatusDiagnosticsModal';\r\n\r\nconst StateMeta: Record<string, { color: string; label: string }> = {\r\n  connected: { color: 'bg-green-500', label: 'Connected' },\r\n  degraded: { color: 'bg-amber-500', label: 'Degraded' },\r\n  offline: { color: 'bg-red-600', label: 'Offline' }\r\n};\r\n\r\nconst StatusChip: React.FC = () => {\r\n  const { state, latencyMs, version, baseUrl } = useHealth();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const meta = StateMeta[state] || StateMeta.offline;\r\n\r\n  const statusClass = state === 'connected' ? 'status-online' : state === 'degraded' ? 'status-degraded' : 'status-offline';\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        onClick={() => setOpen(true)}\r\n        className={`status-chip ${statusClass} focus:outline-none focus:ring-2 focus:ring-offset-2 text-sm`}\r\n        aria-haspopup=\"dialog\"\r\n        aria-expanded={open}\r\n        aria-label={`Backend status: ${meta.label}`}\r\n        role=\"status\"\r\n      >\r\n        <span className=\"dot\" aria-hidden style={{ backgroundColor: 'currentColor' }} />\r\n        <span className=\"sr-only\">Status:</span>\r\n        <span aria-live=\"polite\">{meta.label}</span>\r\n        <span className=\"ml-2 font-mono text-xs opacity-90\">{latencyMs ? `${latencyMs}ms` : ''}</span>\r\n      </button>\r\n      {open && <DiagnosticsModal onClose={() => setOpen(false)} baseUrl={baseUrl} />}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default StatusChip;\r\n"],"names":["relativeTime","iso","d","s","DiagnosticsModal","onClose","baseUrl","checks","lastSuccess","retry","version","useHealth","useRef","useEffect","onKey","e","copyDiagnostics","payload","jsxs","jsx","c","StateMeta","StatusChip","state","latencyMs","open","setOpen","useState","meta","statusClass","Fragment"],"mappings":"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"}